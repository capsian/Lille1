<!DOCTYPE html>
<html lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Algorithmes de résolution de requête</title>
<!-- 2021-03-09 mar. 12:04 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Sylvain Salvati">

<link href="tp1_data/bootstrap.css" rel="stylesheet">
<script src="tp1_data/jquery.js"></script>
<script src="tp1_data/bootstrap.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

.code-highlighted { background-color: #ffff00; }

/* .verbatim { color: #3e9409;
            background-color: #f5fbf4; }*/
.verbatim {
    color: #337ab7;
    background-color: #d9edf7; }


/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<style>body { margin-bottom: 0px; }</style><script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }

</script>

<script type="text/x-mathjax-config;executed=true">
MathJax.Hub.Config({
  displayAlign: "center",
  displayIndent: "2em",
  messageStyle: "none",
  "HTML-CSS": {
    scale: 100,
    styles: {
      ".MathJax_Display": {
        "font-size": "100%"
      }
    }
  },
  "SVG": {
    scale: 100,
    styles: {
      ".MathJax_SVG_Display": {
        "font-size": "100%",
        "margin-left": "-2.281em"
      }
    }
  }
});
</script>
<script src="tp1_data/MathJax.js" id=""></script>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_SVG_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%; font-size: 100%; margin-left: -2.281em}
.MathJax_SVG .MJX-monospace {font-family: monospace}
.MathJax_SVG .MJX-sans-serif {font-family: sans-serif}
#MathJax_SVG_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax_SVG {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax_SVG * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.mjx-svg-href {fill: blue; stroke: blue}
.MathJax_SVG_Processing {visibility: hidden; position: absolute; top: 0; left: 0; width: 0; height: 0; overflow: hidden; display: block!important}
.MathJax_SVG_Processed {display: none!important}
.MathJax_SVG_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0}
.MathJax_SVG_LineBox {display: table!important}
.MathJax_SVG_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax_SVG .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px none; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_SVG_Hidden"></div><svg><defs id="MathJax_SVG_glyphs"><path stroke-width="1" id="MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="MJSZ2-2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path><path stroke-width="1" id="MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="1" id="MJMATHI-76" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path><path stroke-width="1" id="MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="1" id="MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="1" id="MJSZ4-221A" d="M983 1739Q988 1750 1001 1750Q1008 1750 1013 1745T1020 1733Q1020 1726 742 244T460 -1241Q458 -1250 439 -1250H436Q424 -1250 424 -1248L410 -1166Q395 -1083 367 -920T312 -601L201 44L137 -83L111 -57L187 96L264 247Q265 246 369 -357Q470 -958 473 -963L727 384Q979 1729 983 1739Z"></path><path stroke-width="1" id="MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="MJSZ4-28" d="M758 -1237T758 -1240T752 -1249H736Q718 -1249 717 -1248Q711 -1245 672 -1199Q237 -706 237 251T672 1700Q697 1730 716 1749Q718 1750 735 1750H752Q758 1744 758 1741Q758 1737 740 1713T689 1644T619 1537T540 1380T463 1176Q348 802 348 251Q348 -242 441 -599T744 -1218Q758 -1237 758 -1240Z"></path><path stroke-width="1" id="MJSZ4-29" d="M33 1741Q33 1750 51 1750H60H65Q73 1750 81 1743T119 1700Q554 1207 554 251Q554 -707 119 -1199Q76 -1250 66 -1250Q65 -1250 62 -1250T56 -1249Q55 -1249 53 -1249T49 -1250Q33 -1250 33 -1239Q33 -1236 50 -1214T98 -1150T163 -1052T238 -910T311 -727Q443 -335 443 251Q443 402 436 532T405 831T339 1142T224 1438T50 1716Q33 1737 33 1741Z"></path></defs></svg></div><div id="MathJax_Message" style="display: none;"></div>
<div id="content" class="container">
<div class="row"><div class="col-md-3 col-md-push-9"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar affix-top">
<ul class="nav">
<li class="active"><a href="#sec-1">1. Objectifs</a></li>
<li><a href="#sec-2">2. Concept préalable : les flux</a>
<ul class="nav">
<li><a href="#sec-2-1">2.1. Le principe</a></li>
<li><a href="#sec-2-2">2.2. Les flux en <code class="verbatim">python</code></a></li>
</ul>
</li>
<li><a href="#sec-3">3. Implémentation des opérateurs de l'algèbre relationnelle</a>
<ul class="nav">
<li><a href="#sec-3-1">3.1. Projection, concaténation (union), sélection</a></li>
<li><a href="#sec-3-2">3.2. Les algorithmes de jointure</a></li>
<li><a href="#sec-3-3">3.3. L'agrégation</a></li>
</ul>
</li>
</ul>
</div>
</nav>
</div><div class="col-md-9 col-md-pull-3"><h1 class="title">Algorithmes de résolution de requête</h1>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Objectifs</h2>
<div class="outline-text-2" id="text-1">
<p>
Ce TP vous propose d'explorer les algorithmes utilisés par les systèmes de
bases de données pour répondre aux requêtes qui leur sont envoyées. Cette
exploration s'effectue dans un cadre simplifié :
</p>
<ol class="org-ol">
<li>nous n'irons pas jusqu'aux détails de la gestion de la mémoire faite par ces
algorithmes,
</li>
<li>nous oublierons les subtilités de la gestion des accès disque,
</li>
<li>enfin, nous ne verrons pas comment utiliser le disque dur pour stocker des
résultats intermédiaires de requête trop volumineux pour tenir en mémoire.
</li>
</ol>

<p>
Néanmoins, nous nous efforcerons au cours du TP d'évoquer ces détails afin de
comprendre les difficultés techniques qu'ils soulèvent.
</p>

<p>
Le TP s'effectuera en python.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Concept préalable : les flux</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Le principe</h3>
<div class="outline-text-3" id="text-2-1">
<p>
La résolution d'une requête dans une base de données requiert la combinaison
de nombreuses opérations. Il s'agit :
</p>
<ul class="org-ul">
<li>de lire les tables sur le disque,
</li>
<li>de supprimer les colonnes inutiles,
</li>
<li>de filtrer les lignes inutiles,
</li>
<li>de calculer des jointures,
</li>
<li>de calculer des agrégats
</li>
<li>etc.
</li>
</ul>


<p>
Pour faire en sorte que ces calculs n'utilisent pas toute la mémoire de la
machine, ceux-ci sont organisés en flux : les opérations produisent des
résultats qui sont consommés au fur et à mesure par d'autres opérations.
Cela évite ainsi de stocker l'intégralité des tables en mémoire. D'ailleurs,
il est en général impossible de stocker en mémoire vive l'intégralité d'une
table d'une bases données de taille industrielle.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Les flux en <code class="verbatim">python</code></h3>
<div class="outline-text-3" id="text-2-2">
<p>
<code class="verbatim">Python</code> permet assez naturellement de manipuler des flux. Pour cela, il
suffit d'utiliser dans une fonction le mot clé <code>yield</code>. Par exemple le code
suivant génère le flux des carrés des nombres de <code>0</code> à <code>n-1</code>:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">flux_carres</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Flux des carrés de 0 à n-1"""</span>
    <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
<span id="coderef-yield-carre" class="coderef-off">        <span style="color: #0000FF;">yield</span> i*i</span>
</pre>
</div>
<p>
Dans ce programme, <a href="#coderef-yield-carre" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-yield-carre');" onmouseout="CodeHighlightOff(this, 'coderef-yield-carre');">la ligne commençant par <code>yield</code></a> renvoie
le carré courant et le calcul est suspendu jusqu'à une nouvelle demande. Les
fonctions de ce type s'appellent <b>générateurs</b> (<b>generators</b> en anglais) en
<code class="verbatim">python</code> et peuvent être utilisés dans des boucles.
Par exemple, exécutez le code suivant et observez ce qu'il produit :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">carres</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
  <span style="color: #BA36A5;">res</span> = <span style="color: #707183;">[]</span>
  <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span><span style="color: #008000;">"foo"</span><span style="color: #707183;">)</span>
    res.append<span style="color: #707183;">(</span>i*i<span style="color: #707183;">)</span>
  <span style="color: #0000FF;">return</span> res

<span style="color: #0000FF;">def</span> <span style="color: #006699;">flux_carres_bis</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
  <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span><span style="color: #008000;">"bar"</span><span style="color: #707183;">)</span>
    <span style="color: #0000FF;">yield</span> i*i

<span style="color: #0000FF;">for</span> c <span style="color: #0000FF;">in</span> carres<span style="color: #707183;">(</span><span style="color: #D0372D;">10</span><span style="color: #707183;">)</span>:
  <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>c<span style="color: #707183;">)</span>

<span style="color: #0000FF;">for</span> c <span style="color: #0000FF;">in</span> flux_carres_bis<span style="color: #707183;">(</span><span style="color: #D0372D;">10</span><span style="color: #707183;">)</span>:
  <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>c<span style="color: #707183;">)</span>
</pre>
</div>



<p>
Ainsi nous pouvons écrire une fonction qui calcule la somme des carrés de
<code>0</code> à <code>n-1</code> de la manière suivante en nous servant de notre générateur
<code>flux_carres</code>:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">somme_carres</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Calcule la somme des carrés de 0 à n-1."""</span>
    <span style="color: #BA36A5;">res</span> = <span style="color: #D0372D;">0</span>
    <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> flux_carres<span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
        <span style="color: #BA36A5;">res</span> += i
    <span style="color: #0000FF;">return</span> res
</pre>
</div>
<p>
L'avantage de cette approche est double : d'une part, elle évite de
consommer trop de mémoire (en ne stockant pas en mémoire la liste des carrés),
et d'autre part elle évite de devoir attendre que tous les carrés soient
générés avant pouvoir les utiliser. En écrivant la fonction <code>somme_carres</code> de la
manière suivante:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">somme_carres_bis</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">sum</span><span style="color: #707183;">(</span><span style="color: #7388D6;">[</span>i*i <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #909183;">(</span>n<span style="color: #909183;">)</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>
</pre>
</div>
<p>
la liste de tous les carrés entre <code>0</code> et <code>n-1</code> va être générée et stockée en
mémoire, ce qui peut être problématique pour les grandes valeurs de <code>n</code>. À
l'inverse l'utilisation du générateur <code>flux_carres</code> évite ce problème et
<code>somme_carres</code> a une faible empreinte mémoire.
</p>


<p>
Les générateurs peuvent être écrits et composés de façon très
similaire aux listes en compréhension. Il suffit pour cela de remplacer les
crochets <code>[</code> <code>]</code> par des parenthèses <code>(</code> <code>)</code>. Nous pouvons réécrire la
fonction <code>somme_carres</code> avec un générateur de la manière suivante (même si
cela peut sembler artificiel) :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">somme_carres_ter</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #BA36A5;">res</span> = <span style="color: #D0372D;">0</span>
    <span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> <span style="color: #707183;">(</span>i*i <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #7388D6;">(</span>n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>:
        <span style="color: #BA36A5;">res</span>+=k
    <span style="color: #0000FF;">return</span> k
</pre>
</div>
<p>
La fonction <code>sum</code> utilise à son avantage les générateurs et permet de sommer
sans empreinte mémoire. Nous pouvons ainsi écrire <code>somme_carres</code> comme ceci :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">somme_carres_quad</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>:
    <span style="color: #0000FF;">return</span> <span style="color: #006FE0;">sum</span><span style="color: #707183;">(</span>i*i <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #7388D6;">(</span>n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
<p>
Tout comme pour les listes en compréhension, les générateurs peuvent être
composés, utiliser des filtres, etc.
</p>

<p>
Nous essaierons autant que possible de faire en sorte que les algorithmes de
résolutions de requête que nous implémenterons soient des générateurs.
</p>

<p>
Vous pourrez trouver plus de détails sur les générateurs sur le
<a href="https://wiki.python.org/moin/Generators">wiki de <code class="verbatim">python</code></a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Implémentation des opérateurs de l'algèbre relationnelle</h2>
<div class="outline-text-2" id="text-3">
<p>
Nous allons représenter les tables comme des flux de dictionnaires. Les
dictionnaires représenteront les tuples de la table :
</p>
<ul class="org-ul">
<li>chaque clé du dictionnaire représente un attribut de la table,
</li>
<li>la valeur associée à la clé dans un dictionnaire représente la valeur qui est
stockée par cet attribut dans le tuple. En général, nous nous contenterons de
valeurs entières pour ce TP.
</li>
</ul>


<p>
Afin de simuler des tables de tailles variées, nous allons les générer
aléatoirement à l'aide de la fonction suivante :
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">table</span><span style="color: #707183;">(</span>descr, nb=<span style="color: #D0372D;">10000</span><span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Cette fonction génère une séquence de tuples décrits par le dictionnaire</span>
<span style="color: #036A07;">    descr. Le dictionnaire associe à une clé une paire (k,l). La fonction</span>
<span style="color: #036A07;">    génère nb dictionnaires de la manière suivante :</span>
<span style="color: #036A07;">    - chaque clé de descr est une clé de ces dictionnaires</span>
<span style="color: #036A07;">    - à chacune de ces clés x, ces dictionnaires associent un nombre tiré au hasard</span>
<span style="color: #036A07;">      entre k et l lorsque la paire (k,l) est associée à x dans descr.</span>
<span style="color: #036A07;">    NB : cette fonction requiert d'importer le module random.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">for</span> _ <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #707183;">(</span>nb<span style="color: #707183;">)</span>:
        <span style="color: #BA36A5;">tuple_res</span> = <span style="color: #707183;">{}</span>
        <span style="color: #0000FF;">for</span> a, <span style="color: #707183;">(</span>k,l<span style="color: #707183;">)</span> <span style="color: #0000FF;">in</span> descr.items<span style="color: #707183;">()</span>:
            <span style="color: #BA36A5;">tuple_res</span><span style="color: #707183;">[</span>a<span style="color: #707183;">]</span> = random.randint<span style="color: #707183;">(</span><span style="color: #006FE0;">min</span><span style="color: #7388D6;">(</span>k, l<span style="color: #7388D6;">)</span>, <span style="color: #006FE0;">max</span><span style="color: #7388D6;">(</span>k, l<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
        <span style="color: #0000FF;">yield</span> tuple_res
</pre>
</div>


<p>
Voici un exemple d'utilisation de cette fonction qui affiche tous les tuples
générés (ici on choisit de générer une table qui ne contient que 10 éléments) :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_table</span><span style="color: #707183;">()</span>:
    <span style="color: #036A07;">"""Exemple d'utilisation de la fonction table. Génère une table de 10 éléments</span>
<span style="color: #036A07;">comportant les attributs 'a' et 'b' et les affiche en flux."""</span>
    <span style="color: #BA36A5;">schema</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">100</span>,<span style="color: #D0372D;">100000</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #0000FF;">for</span> tuple_tbl <span style="color: #0000FF;">in</span> table<span style="color: #707183;">(</span>schema,nb=<span style="color: #D0372D;">10</span><span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tuple_tbl<span style="color: #707183;">)</span>
</pre>
</div>
</div>


<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Projection, concaténation (union), sélection</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Nous allons maintenant implémenter les opérations les plus simples de
l'algèbre relationnelle. Pour ces opérations, il faut garder à l'esprit que
l'on souhaite autant que possible maintenir ces opérations en flux, dans le but
d'éviter de mémoriser les tuples traités.
</p>
</div>


<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> La projection</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Nous allons commencer par la projection. Il s'agit, étant données une table et
une liste d'attributs, de renvoyer une table (sous forme de flux) qui ne
contient que les attributs présents dans la liste d'attributs.
</p>

<p>
Cela correspond aux requêtes <code class="verbatim">sql</code> de la forme suivante :
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> id, nom <span style="color: #0000FF;">FROM</span> etudiants;
</pre>
</div>
<p>
où on ne sélectionne qu'une partie des attributs d'une table.
</p>

<p>
Vous compléterez la fonction ci-dessous :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">projection</span><span style="color: #707183;">(</span>table, champs<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""</span>
<span style="color: #036A07;">    Renvoie la table (sous forme de flux) obtenue à partir des tuples contenus</span>
<span style="color: #036A07;">    dans ~table~ en n'y conservant que les attributs (les clés) qui sont</span>
<span style="color: #036A07;">    contenus dans ~champs~.</span>

<span style="color: #036A07;">    Renvoie une exception si un attribut de ~champs~ n'est pas un attribut des</span>
<span style="color: #036A07;">    tuples de ~table~.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Voici un exemple d'utilisation de cette fonction :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_projection</span><span style="color: #707183;">()</span>:
    <span style="color: #036A07;">"""Exemple d'utilisation de la projection."""</span>
    <span style="color: #BA36A5;">schema</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">40</span>, <span style="color: #D0372D;">100</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'c'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">20</span>,<span style="color: #D0372D;">30</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #0000FF;">for</span> tuple_res <span style="color: #0000FF;">in</span> projection<span style="color: #707183;">(</span>table<span style="color: #7388D6;">(</span>schema ,nb=<span style="color: #D0372D;">100</span><span style="color: #7388D6;">)</span>,
                                <span style="color: #7388D6;">[</span><span style="color: #008000;">'a'</span>, <span style="color: #008000;">'c'</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tuple_res<span style="color: #707183;">)</span>
</pre>
</div>


<p>
Un point de vue plus général sur la projection consiste à la voir comme
l'application d'une fonction à chacun des tuples de la table. Par exemple,
la requête suivante effectue une telle transformation :
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> id, <span style="color: #707183;">(</span>note1 + note2<span style="color: #707183;">)</span>/<span style="color: #D0372D;">2</span> <span style="color: #0000FF;">AS</span> moyenne <span style="color: #0000FF;">FROM</span> etudiants;
</pre>
</div>

<p>
Pour implémenter ce type d'opération, complétez cette fonction (vous pouvez
penser à utiliser la définition des flux en extension) :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">transformation</span><span style="color: #707183;">(</span>table, f<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie un flux obtenu en appliquant ~f~ à chacun des tuples composant</span>
<span style="color: #036A07;">~table~."""</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Voici un exemple d'utilisation de cette fonction :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_transformation</span><span style="color: #707183;">()</span>:
    <span style="color: #BA36A5;">schema</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">40</span>, <span style="color: #D0372D;">100</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'c'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">20</span>,<span style="color: #D0372D;">30</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #BA36A5;">f</span> = <span style="color: #0000FF;">lambda</span> tp: <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: tp<span style="color: #7388D6;">[</span><span style="color: #008000;">'a'</span><span style="color: #7388D6;">]</span>, <span style="color: #008000;">'m'</span>: <span style="color: #7388D6;">(</span>tp<span style="color: #909183;">[</span><span style="color: #008000;">'b'</span><span style="color: #909183;">]</span>+tp<span style="color: #909183;">[</span><span style="color: #008000;">'c'</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>//<span style="color: #D0372D;">2</span><span style="color: #707183;">}</span>
    <span style="color: #0000FF;">for</span> tuple_res <span style="color: #0000FF;">in</span> transformation<span style="color: #707183;">(</span>table<span style="color: #7388D6;">(</span>schema,nb=<span style="color: #D0372D;">100</span><span style="color: #7388D6;">)</span>, f<span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tuple_res<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Réécrire la fonction <code>projection</code> à l'aide de la fonction <code>transformation</code>
(penser à utiliser une définition de fonction dans la fonction,
<a href="https://realpython.com/inner-functions-what-are-they-good-for/">voir ici par exemple</a>):
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">projection2</span><span style="color: #707183;">(</span>table, champs<span style="color: #707183;">)</span>:

    <span style="color: #036A07;">"""</span>
<span style="color: #036A07;">    Renvoie la table (sous forme de flux) obtenue à partir des tuples contenus</span>
<span style="color: #036A07;">    dans ~table~ en n'y conservant que les attributs (les clés) qui sont</span>
<span style="color: #036A07;">    contenus dans ~champs~.</span>

<span style="color: #036A07;">    Renvoie une erreur si un attribut de ~champs~ n'est pas un attribut des</span>
<span style="color: #036A07;">    tuples de ~table~.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> L'union</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Une opération relativement simple est l'union de deux tables. Il s'agit de
construire un flux de données (de tuples) en énumérant les données d'un
premier flux, puis, lorsque ce premier flux est épuisé, d'énumérer le
second.
L'opérateur équivalent en SQL s'appelle UNION ALL, alors que l'opérateur UNION enlève les doublons.
</p>

<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table1 <span style="color: #0000FF;">UNION</span> <span style="color: #0000FF;">ALL</span> <span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table2 ;
</pre>
</div>

<p>
Complétez la fonction suivante :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">union</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Construit un flux qui énumère les éléments de ~t1~ puis ceux de ~t2~."""</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Un exemple d'utilisation de cette fonction:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_union</span><span style="color: #707183;">()</span>:
    <span style="color: #036A07;">"""Exemple d'utilisation de la fonction union."""</span>
    <span style="color: #BA36A5;">schema1</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>:<span style="color: #7388D6;">(</span><span style="color: #D0372D;">30</span>, <span style="color: #D0372D;">100</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">10</span>, <span style="color: #D0372D;">50</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #BA36A5;">schema2</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">40</span>, <span style="color: #D0372D;">50</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'n'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">100</span>, <span style="color: #D0372D;">200</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'m'</span>: <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #BA36A5;">f</span> = <span style="color: #0000FF;">lambda</span> tp: <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span>: tp<span style="color: #7388D6;">[</span><span style="color: #008000;">'a'</span><span style="color: #7388D6;">]</span>//<span style="color: #D0372D;">2</span>, <span style="color: #008000;">'b'</span>: <span style="color: #7388D6;">(</span>tp<span style="color: #909183;">[</span><span style="color: #008000;">'m'</span><span style="color: #909183;">]</span>*tp<span style="color: #909183;">[</span><span style="color: #008000;">'m'</span><span style="color: #909183;">]</span><span style="color: #7388D6;">)</span>//<span style="color: #D0372D;">4</span><span style="color: #707183;">}</span>
    <span style="color: #0000FF;">for</span> tp <span style="color: #0000FF;">in</span> union<span style="color: #707183;">(</span>table<span style="color: #7388D6;">(</span>schema1, nb = <span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>,
                    transformation<span style="color: #7388D6;">(</span>table<span style="color: #909183;">(</span>schema2,nb=<span style="color: #D0372D;">10</span><span style="color: #909183;">)</span>,f<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tp<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> La sélection</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
L'opération de sélection consiste à ne conserver dans un flux que les
éléments qui vérifient une certaine propriété.
</p>

<p>
Typiquement, c'est l'opération réalisée par ce type de requêtes :
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> etudiants <span style="color: #0000FF;">WHERE</span> date_inscription &lt;= <span style="color: #D0372D;">2020</span> <span style="color: #0000FF;">AND</span> date_inscription &gt;= <span style="color: #D0372D;">2018</span>;
</pre>
</div>

<p>
Nous allons implémenter la sélection par un prédicat, c'est-à-dire une
fonction qui à un tuple associe un booléen. Pour cela, complétez la définition
suivante :
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">selection</span><span style="color: #707183;">(</span>table, pred<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Construit le flux des éléments de ~table~ qui satisfont le prédicat</span>
<span style="color: #036A07;">       ~pred~ (fonction des tuples dans les booléens)."""</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Exemple d'utilisation de <code>selection</code> :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_selection</span><span style="color: #707183;">()</span>:
    <span style="color: #0000FF;">for</span> un_tuple <span style="color: #0000FF;">in</span> selection<span style="color: #707183;">(</span>table<span style="color: #7388D6;">(</span><span style="color: #909183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #709870;">(</span><span style="color: #D0372D;">30</span>, <span style="color: #D0372D;">100</span><span style="color: #709870;">)</span>, <span style="color: #008000;">'b'</span>: <span style="color: #709870;">(</span><span style="color: #D0372D;">10</span>, <span style="color: #D0372D;">50</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span>, nb=<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>,
               <span style="color: #0000FF;">lambda</span> tp: tp<span style="color: #7388D6;">[</span><span style="color: #008000;">'a'</span><span style="color: #7388D6;">]</span> &gt; <span style="color: #D0372D;">50</span> <span style="color: #0000FF;">and</span> tp<span style="color: #7388D6;">[</span><span style="color: #008000;">'b'</span><span style="color: #7388D6;">]</span> &lt; <span style="color: #D0372D;">45</span><span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>un_tuple<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-4" class="outline-4">
<h4 id="sec-3-1-4"><span class="section-number-4">3.1.4</span> La sélection en présence d'index</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
Lorsqu'une table est très grande, par exemple lorsqu'elle contient plus de
10<sup>9</sup> tuples, la parcourir intégralement a un coût très important. Si le
nombre de tuples sélectionnés par une requête est faible par rapport au
nombre total de tuples de la table, on utilise un <b>index</b> pour les
retrouver directement.
</p>

<p>
Afin de simuler les index, nous vous fournissons un ensemble de fonctions
qui permettent de sauver les tables sur le disque, puis de créer un index de
ces tables en mémoire. Cet index va associer à chaque valeur indexée
la liste des adresses physiques sur le disque des tuples dont le
champ indexé contient cette valeur. Ainsi pour une valeur donnée, on pourra récupérer
ces tuples sans devoir lire toute la table sur le disque.
</p>
</div>

<ol class="org-ol"><li><a id="sec-3-1-4-1" name="sec-3-1-4-1"></a>Quelques fonctions pour créer et utiliser des tables sur disque<br><div class="outline-text-5" id="text-3-1-4-1">
<p>
Les fonctions utiles pour le TP sont les suivantes (elles se trouvent dans
le module <code>disque</code>) :
</p>
<ul class="org-ul">
<li><code>mem_sur_disque(table, fichier)</code> : sauvegarde <code>table</code> dans <code>fichier</code>,
</li>
<li><code>lire_sur_fichier(fichier)</code> : renvoie le flux des tuples de la table
contenue dans <code>fichier</code>,
</li>

<li><code>index_fichier(fichier, attribut)</code> : renvoie un dictionnaire qui à chaque
valeur <code>v</code> associe la liste des adresses dans <code>fichier</code> des tuples
associant <code>v</code> à <code>attribut</code>.
</li>

<li><code>trouver_sur_disque(fichier, adresses)</code> : renvoie le flux des tuples dans <code>fichier</code>
ayant des adresses physiques dans <code>adresses</code>.
</li>
</ul>


<p>
Typiquement nous utiliserons ces fonctions de la manière suivante :
</p>
<div class="org-src-container">

<pre class="src src-python"><span id="coderef-ex_schema" class="coderef-off"><span style="color: #BA36A5;">schema</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span> : <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span> : <span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">10000000</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span></span>
<span id="coderef-ex_table" class="coderef-off"><span style="color: #BA36A5;">tbl</span> = table<span style="color: #707183;">(</span>schema, nb=<span style="color: #D0372D;">1000000</span><span style="color: #707183;">)</span></span>
<span id="coderef-ex_fichier" class="coderef-off"><span style="color: #BA36A5;">fichier</span> = <span style="color: #008000;">"/tmp/tbl.table"</span></span>
<span id="coderef-ex_sur_disque" class="coderef-off">mem_sur_disque<span style="color: #707183;">(</span>tbl, fichier<span style="color: #707183;">)</span></span>
<span id="coderef-ex_index_a" class="coderef-off"><span style="color: #BA36A5;">idx</span> = index_fichier<span style="color: #707183;">(</span>fichier, <span style="color: #008000;">'a'</span><span style="color: #707183;">)</span></span>
<span id="coderef-ex_a_0" class="coderef-off"><span style="color: #BA36A5;">b0</span> = trouve_sur_disque<span style="color: #707183;">(</span><span style="color: #008000;">"/tmp/tbl.table"</span>,idx<span style="color: #7388D6;">[</span><span style="color: #D0372D;">0</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span></span>
<span id="coderef-ex_somme" class="coderef-off"><span style="color: #0000FF;">print</span><span style="color: #707183;">(</span><span style="color: #006FE0;">sum</span><span style="color: #7388D6;">(</span>t<span style="color: #909183;">[</span><span style="color: #008000;">'b'</span><span style="color: #909183;">]</span> <span style="color: #0000FF;">for</span> t <span style="color: #0000FF;">in</span> b0<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span></span>
</pre>
</div>
<ul class="org-ul">
<li><a href="#coderef-ex_schema" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_schema');" onmouseout="CodeHighlightOff(this, 'coderef-ex_schema');">On commence par définir la forme des tuples</a>
</li>
<li><a href="#coderef-ex_table" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_table');" onmouseout="CodeHighlightOff(this, 'coderef-ex_table');">On produit le flux de la table</a>
</li>
<li><a href="#coderef-ex_fichier" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_fichier');" onmouseout="CodeHighlightOff(this, 'coderef-ex_fichier');">On choisit le fichier où nous allons sauvegarder les données</a>
</li>
<li><a href="#coderef-ex_sur_disque" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_sur_disque');" onmouseout="CodeHighlightOff(this, 'coderef-ex_sur_disque');">On enregistre la table sur disque dans le fichier</a>
</li>
<li><a href="#coderef-ex_index_a" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_index_a');" onmouseout="CodeHighlightOff(this, 'coderef-ex_index_a');">On crée un index des tuples du fichier pour l'attribut <code>'a'</code></a>
</li>
<li><a href="#coderef-ex_a_0" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_a_0');" onmouseout="CodeHighlightOff(this, 'coderef-ex_a_0');">On crée le flux des tuples de la table pour lesquels <code>'a'</code> a pour valeur <code>0</code> à l'aide de l'index</a>
</li>
<li><a href="#coderef-ex_somme" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-ex_somme');" onmouseout="CodeHighlightOff(this, 'coderef-ex_somme');">On imprime la somme des valeurs de l'attribut <code>'b'</code> des tuples sélectionnés</a>
</li>
</ul>
</div>
</li>



<li><a id="sec-3-1-4-2" name="sec-3-1-4-2"></a>Calcul d'une sélection à partir d'un index<br><div class="outline-text-5" id="text-3-1-4-2">
<p>
Vous allez maintenant écrire la fonction <code>selection_index(fichier, idx, valeurs)</code>
suivante :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">selection_index</span><span style="color: #707183;">(</span>fichier, idx, valeurs<span style="color: #707183;">)</span> :
    <span style="color: #036A07;">"""</span>
<span style="color: #036A07;">    On suppose que ~fichier~ contient des tuples dont l'une des colonnes est</span>
<span style="color: #036A07;">    indexée par ~idx~. La fonction renvoie le flux des tuples qui associe a la</span>
<span style="color: #036A07;">    colonne indexée une valeur dans la séquence ~valeurs~.</span>

<span style="color: #036A07;">    Attention : si un élément de ~valeurs~ n'est pas référencé dans ~idx~, on</span>
<span style="color: #036A07;">    souhaite qu'il n'y ait pas d'erreur.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Voici un exemple d'utilisation de cette fonction où on sélectionne dans une
table (générée pour l'occasion et indexée suivant l'attribut <code>a</code>) les tuples
qui associent une valeur entre 2 et 4 à l'attribut <code>a</code> :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">exemple_selection_index</span><span style="color: #707183;">()</span>:
    <span style="color: #BA36A5;">schema</span> = <span style="color: #707183;">{</span><span style="color: #008000;">'a'</span> : <span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span>, <span style="color: #008000;">'b'</span> : <span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">10000000</span><span style="color: #7388D6;">)</span><span style="color: #707183;">}</span>
    <span style="color: #BA36A5;">tbl</span> = table<span style="color: #707183;">(</span>schema, nb=<span style="color: #D0372D;">1000000</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5;">fichier</span> = <span style="color: #008000;">"/tmp/tbl.table"</span>
    mem_sur_disque<span style="color: #707183;">(</span>tbl, fichier<span style="color: #707183;">)</span>
    <span style="color: #BA36A5;">idx</span> = index_fichier<span style="color: #707183;">(</span>fichier, <span style="color: #008000;">'a'</span><span style="color: #707183;">)</span>
    <span style="color: #0000FF;">for</span> tp <span style="color: #0000FF;">in</span> selection_index<span style="color: #707183;">(</span>fichier, idx, <span style="color: #006FE0;">range</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span>,<span style="color: #D0372D;">5</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>:
        <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tp<span style="color: #707183;">)</span>

</pre>
</div>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Les algorithmes de jointure</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Nous allons maintenant voir plusieurs algorithmes de calcul de jointure.
Il s'agit de l'une des opérations les plus coûteuses lors de la résolution de
requête pour un système de bases de données. Ainsi, il y a un grand nombre
d'algorithmes qui cherchent à tirer partie de propriétés particulières des
tables à joindre pour gagner en efficacité.
</p>
</div>

<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> Produit cartésien</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Avant de calculer la jointure entre deux tables, nous allons nous occuper
d'une opération plus élémentaire : le calcul du produit cartésien de deux
tables. Le produit cartésien est calculé par les requêtes sql suivantes :
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table1 <span style="color: #0000FF;">CROSS</span> <span style="color: #0000FF;">JOIN</span> table2;
</pre>
</div>
<p>
ou encore
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table1, table2;
</pre>
</div>

<p>
Cependant avant même d'implémenter le produit cartésien, comme nous ne
souhaitons manipuler que des tuples, nous allons écrire une fonction
permettant d'assembler deux tuples en un seul.
</p>
</div>

<ol class="org-ol"><li><a id="sec-3-2-1-1" name="sec-3-2-1-1"></a>Appariement de tuples<br><div class="outline-text-5" id="text-3-2-1-1">
<p>
Nous allons tout d'abord voir comment nous allons réaliser l'<i>appariement</i>
de deux tuples. Idéalement nous souhaiterions que cet appariement consiste
à faire l'union des dictionnaires : chaque clé de l'un des dictionnaires
est dans le dictionnaire résultat et celui-ci associe à la clé la valeur
qui lui est associée par l'un des tuples de départ. Si les deux tuples
n'ont aucun attribut en commun, alors il n'y a pas de difficulté. Dans le
cas contraire, nous décidons (un peu arbitrairement) de donner la priorité
au second tuple : nous allons associer, dans le résultat, les valeurs du
second tuple aux clés communes aux deux tuples.
</p>

<p>
Complétez la fonction ci-dessous.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">appariement</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie un tuple ayant pour clé les clés de ~t1~ et de ~t2~.</span>

<span style="color: #036A07;">    Lorsqu'une clé n'apparaît que dans un tuple la valeur que lui associe ce</span>
<span style="color: #036A07;">    tuple est celle associée à la clé dans le résultat.</span>

<span style="color: #036A07;">    À une clé qui apparaît dans les deux tuples, le résultat associe la valeur</span>
<span style="color: #036A07;">    que lui associe ~t2~.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">return</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-3-2-1-2" name="sec-3-2-1-2"></a>L'algorithme de double boucle<br><div class="outline-text-5" id="text-3-2-1-2">
<p>
Pour générer le produit cartésien nous allons utiliser un algorithme qui
utilise deux boucles imbriquées :
</p>
<ol class="org-ol">
<li>Une boucle parcourt la première table en sélectionant un tuple <code>tp</code> à chaque
tour.
</li>
<li>La seconde boucle, à l'intérieur de la première, parcourt la seconde
table et renvoie le flux des tuples de cette table, appariés avec <code>tp</code>.
</li>
</ol>

<p>
Écrivez cet algorithme dans le squelette de code suivant :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">produit_cartesien</span><span style="color: #707183;">(</span>table1, table2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Construit le flux de tuples obtenus en appariant tous les tuples de</span>
<span style="color: #036A07;">    ~table1~ et de ~table2~.</span>

<span style="color: #036A07;">    Ce flux correspond au produit cartésien des deux tables produit par l'algorithme double boucle :</span>
<span style="color: #036A07;">    - ~table1~ est la table utilisée dans le boucle extérieure,</span>
<span style="color: #036A07;">    - ~table2~ est la table utilisée dans la boucle intérieure.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-3-2-1-3" name="sec-3-2-1-3"></a>Un problème avec les flux en mémoire<br><div class="outline-text-5" id="text-3-2-1-3">
<p>
Exécutez le bloc de code suivant :
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">tb1</span> = table<span style="color: #707183;">(</span><span style="color: #7388D6;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #909183;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #909183;">)</span><span style="color: #7388D6;">}</span>, nb=<span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>
<span style="color: #BA36A5;">tb2</span> = table<span style="color: #707183;">(</span><span style="color: #7388D6;">{</span><span style="color: #008000;">'b'</span>: <span style="color: #909183;">(</span><span style="color: #D0372D;">2</span>,<span style="color: #D0372D;">2</span><span style="color: #909183;">)</span><span style="color: #7388D6;">}</span>, nb=<span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">for</span> tp <span style="color: #0000FF;">in</span> produit_cartesien<span style="color: #707183;">(</span>tb1,tb2<span style="color: #707183;">)</span>:
    <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tp<span style="color: #707183;">)</span>
</pre>
</div>

<ul class="org-ul">
<li>Combien de tuples auriez-vous du obtenir ?
</li>
<li>À votre avis, quel est le problème ?
</li>
</ul>
</div>
</li>



<li><a id="sec-3-2-1-4" name="sec-3-2-1-4"></a>Implémentation du produit cartésien à partir de tables contenues dans des fichiers<br><div class="outline-text-5" id="text-3-2-1-4">
<p>
Implémentez la fonction suivante pour des tables contenues dans des
fichiers en évitant le problème observé dans la partie précédente.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">produit_cartesien_fichier</span><span style="color: #707183;">(</span>fichier1, fichier2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Construit le flux de tuples obtenus en appariant tous les tuples contenus</span>
<span style="color: #036A07;">    dans les fichiers ~fichier1~ et ~fichier2~.</span>

<span style="color: #036A07;">    Ce flux correspond au produit cartésien des deux tables contenues dans les</span>
<span style="color: #036A07;">    fichiers produit par l'algorithme double boucle :</span>
<span style="color: #036A07;">    - la table contenue dans ~fichier1~ est utilisée dans la boucle extérieure,</span>
<span style="color: #036A07;">    - la table contenue dans ~fichier2~ est la table utilisée dans la boucle intérieure.</span>

<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
Exécutez le code ci-dessous pour vérifier que vous obtenez le bon
comportement.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">tb</span> = <span style="color: #707183;">[</span>table<span style="color: #7388D6;">(</span><span style="color: #909183;">{</span><span style="color: #008000;">'a'</span>: <span style="color: #709870;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span>, nb=<span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span>, table<span style="color: #7388D6;">(</span><span style="color: #909183;">{</span><span style="color: #008000;">'b'</span>: <span style="color: #709870;">(</span><span style="color: #D0372D;">2</span>,<span style="color: #D0372D;">2</span><span style="color: #709870;">)</span><span style="color: #909183;">}</span>, nb=<span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">]</span>
<span style="color: #BA36A5;">fichiers</span> = <span style="color: #707183;">[</span><span style="color: #008000;">"/tmp/tb1.table"</span>, <span style="color: #008000;">"/tmp/tb2.table"</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span><span style="color: #707183;">(</span><span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>: mem_sur_disque<span style="color: #707183;">(</span>tb<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span>, fichiers<span style="color: #7388D6;">[</span>i<span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>
<span style="color: #0000FF;">for</span> tp <span style="color: #0000FF;">in</span> produit_cartesien_fichier<span style="color: #707183;">(</span>fichiers<span style="color: #7388D6;">[</span><span style="color: #D0372D;">0</span><span style="color: #7388D6;">]</span>,fichiers<span style="color: #7388D6;">[</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">]</span><span style="color: #707183;">)</span>: <span style="color: #0000FF;">print</span><span style="color: #707183;">(</span>tp<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> La jointure</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Nous allons maintenant implémenter quelques-uns des nombreux algorithmes de
jointure. Après notre expérience avec les produits cartésiens, nous allons
systématiquement utiliser des tables stockées sur disque pour calculer les
jointures.
</p>
</div>
<ol class="org-ol"><li><a id="sec-3-2-2-1" name="sec-3-2-2-1"></a>Jointure theta<br><div class="outline-text-5" id="text-3-2-2-1">
<p>
Nous allons ici utiliser les fonctions <code>selection</code> et
<code>produit_cartesien_fichier</code> pour calculer la <i>jointure theta</i>. Il s'agit de
récupérer le flux des tuples de produit cartésien satisfaisant une certaine
propriété.
</p>

<p>
Complétez le code ci-dessous :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_theta</span><span style="color: #707183;">(</span>fichier1, fichier2, pred<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie le flux des appariements de tuples contenus dans les tables des</span>
<span style="color: #036A07;">    fichiers ~fichier1~ et ~fichier2~" qui satisfont la propriété du prédicat</span>
<span style="color: #036A07;">    ~pred~ (fonction des tuples dans les booléens)."""</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>
<li><a id="sec-3-2-2-2" name="sec-3-2-2-2"></a>Jointure naturelle double boucle<br><div class="outline-text-5" id="text-3-2-2-2">
<p>
La jointure naturelle consiste à n'apparier que les tuples qui associent
les mêmes valeurs à leurs attributs communs. En <code class="verbatim">sql</code>, cela correspond aux
requêtes de la forme :
</p>
<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table1 <span style="color: #0000FF;">NATURAL</span> <span style="color: #0000FF;">JOIN</span> table2;
</pre>
</div>

<p>
Complétez le code-ci-dessous :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_naturelle</span><span style="color: #707183;">(</span>fichier1, fichier2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie le flux des tuples de la jointure naturelle des tables contenues</span>
<span style="color: #036A07;">    dans ~fichier1~ et ~fichier2~.</span>

<span style="color: #036A07;">    Il s'agit des appariements des tuples provenant des tables contenues dans</span>
<span style="color: #036A07;">    ~fichier1~et ~fichier2~ qui associent les mêmes valeurs à leurs attributs</span>
<span style="color: #036A07;">    communs.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>
<li><a id="sec-3-2-2-3" name="sec-3-2-2-3"></a>Jointure naturelle/theta double boucle avec une (petite) table en mémoire<br><div class="outline-text-5" id="text-3-2-2-3">
<p>
Lors de l'exécution de l'algorithme double boucle, l'une des tables n'est
lue qu'une seule fois alors que la seconde est lue plusieurs fois. Quelle
est la table qui est lue plusieurs fois :
</p>
<ol class="org-ol">
<li>La table parcourue dans la boucle extérieure ?
</li>
<li>La table parcourue dans la boucle intérieure ?
</li>
</ol>

<p>
Lorsque l'une des deux tables est suffisamment petite pour tenir en
mémoire, il peut être plus efficace de la charger en mémoire. À votre avis,
pour limiter le nombre d'accès au disque dur, quelle table vaut-il mieux
charger en mémoire ?
</p>
<ol class="org-ol">
<li>La table parcourue par la boucle extérieure ?
</li>
<li>La table parcourue par la boucle intérieure ?
</li>
</ol>

<p>
Nous allons utiliser cette idée pour implémenter l'algorithme double boucle
en chargeant l'une des deux tables en mémoire. Complétez le code
ci-dessous. Vous modifierez également la documentation pour préciser quel
fichier est chargé en mémoire.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_naturelle_mem</span><span style="color: #707183;">(</span>fichier1, fichier2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie le flux des tuples de la jointure naturelle des tables contenues</span>
<span style="color: #036A07;">    dans ~fichier1~ et ~fichier2~.</span>

<span style="color: #036A07;">    L'un des deux fichiers est chargé en mémoire afin qu'il ne soit lu qu'une</span>
<span style="color: #036A07;">    seule fois.</span>

<span style="color: #036A07;">    Il s'agit des appariements des tuples provenant des tables contenues dans</span>
<span style="color: #036A07;">    ~fichier1~et ~fichier2~ qui associent les mêmes valeurs à leurs attributs</span>
<span style="color: #036A07;">    communs.</span>

<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>
<li><a id="sec-3-2-2-4" name="sec-3-2-2-4"></a>La jointure avec une table indexée<br><div class="outline-text-5" id="text-3-2-2-4">
<p>
Nous allons maintenant nous intéresser à un type particulier de jointure.
Des jointures qui se font avec la condition que deux attributs des tables à
joindre aient la même valeur. Il s'agit de requêtes de la forme :
</p>

<div class="org-src-container">

<pre class="src src-sqlite"><span style="color: #0000FF;">SELECT</span> * <span style="color: #0000FF;">FROM</span> table1 <span style="color: #0000FF;">JOIN</span> table2 <span style="color: #0000FF;">ON</span> table1.A = table2.B;
</pre>
</div>

<p>
Pour cette partie nous adoptons les hypothèses suivantes :
</p>
<ol class="org-ol">
<li>pour simplifier, les deux tables utilisées n'ont pas
d'attributs en commun.
</li>
<li>la colonne <code>B</code> de <code>table2</code> est indexée.
</li>
</ol>


<p>
Afin de profiter de l'indexation de <code>table2</code>, nous pouvons parcourir
<code>table1</code> et pour chaque tuple chercher dans l'index les adresses physiques
des tuples de <code>table2</code> qui peuvent s'apparier avec ce tuple.
</p>

<p>
En utilisant l'idée que nous venons d'esquisser, compléter la fonction
ci-dessous. Pour rappel :
</p>
<ul class="org-ul">
<li>si <code>index</code> est un index pour la colonne <code>col</code> de la table contenue dans
<code>fichier</code> et <code>k</code> est une clé de l'index, alors <code>index[k]</code> est la liste
des adresses dans <code>fichier</code> des tuples qui à <code>col</code> associent la valeur <code>k</code>.
</li>
<li><code>trouve_sur_disque(fichier, adr)</code> renvoie le flux des tuples de <code>fichier</code>
aux adresses contenues dans <code>adr</code>.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_index</span><span style="color: #707183;">(</span>table1, col1, fichier2, index<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie le flux des tuples de la jointure de la ~table1~ et de la table</span>
<span style="color: #036A07;">    contenue dans ~fichier2~ sous la condition que les valeurs de l'attribut</span>
<span style="color: #036A07;">    ~col1~ de ~table1~ soient identiques aux valeurs de l'attribut ~col2~ la</span>
<span style="color: #036A07;">    table de ~fichier2~.</span>

<span style="color: #036A07;">    ~index~ est un index de l'attribut ~col2~ dans ~fichier2~.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
<b>NB :</b> cet algorithme pourrait assez facilement se généraliser pour les
 jointure theta dans lesquelles l'une des conditions est l'égalité des
 valeurs des attributs <code>A</code> et <code>B</code>.
</p>
</div>
</li>
<li><a id="sec-3-2-2-5" name="sec-3-2-2-5"></a>La jointure avec deux tables indexées<br><div class="outline-text-5" id="text-3-2-2-5">
<p>
Ici nous cherchons à résoudre la même requête que dans la question
précédente avec l'hypothèse supplémentaire que nous disposons d'un index
pour l'attribut <code>A</code> de <code>table1</code>. Au lieu de parcourir les tables, nous
allons parcourir les deux index pour calculer la jointure.
</p>

<p>
Compléter la fonction ci-dessous :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_double_index</span><span style="color: #707183;">(</span>fichier1, index1, fichier2, index2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie le flux de tuples obtenue par la jointure des tables contenues dans</span>
<span style="color: #036A07;">     ~fichier1~ et ~fichier2~ avec la condition que les valeurs indexées par</span>
<span style="color: #036A07;">     ~index1~ pour ~table1~ soient égaux aux valeurs indexées par ~index2~ pour</span>
<span style="color: #036A07;">     ~table2~."""</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-3-2-2-6" name="sec-3-2-2-6"></a>La jointure par fusion de flux triés<br><div class="outline-text-5" id="text-3-2-2-6">
<p>
Nous poursuivons encore avec la même requête, mais cette fois, au lieu de
supposer que nous disposons d'index pour les attributs sur lesquels porte
la condition d'égalité, nous supposons que les tables sont triées dans
l'ordre croissant selon la valeur des attributs concernés.
</p>

<p>
Lorsque deux tables sont triées par rapport aux attributs sur lesquels on
effectue la jointure, celle-ci est plus simple à calculer. On peut en effet
parcourir chacune des tables en progressant suivant les valeurs des
tuples. En particulier, cela permet de ne parcourir chaque table qu'une
seule fois. Cela nous permet d'implémenter cette méthode de jointure
directement sur des flux et non plus depuis des fichiers.
</p>

<p>
Voici une description de l'algorithme que nous allons implémenter :
</p>
<ol class="org-ol">
<li>nous allons charger en mémoire tous les tuples en tête de <code>table1</code>
qui associent la même valeur à l'attribut <code>A</code>,
</li>
<li>nous faisons de même pour les tuples en tête de <code>table2</code> qui associent
la même valeur à l'attribut <code>B</code>,
</li>
<li>suivant la façon dont se comparent la valeur de l'attribut <code>A</code> commune aux tuples de
<code>table1</code> en mémoire à celle de l'attribut <code>B</code> des tuples de <code>table2</code> en mémoire, nous
produisons les appariements, ou nous continuons d'avancer dans l'une des
tables.
</li>
</ol>


<p>
<b>NB</b> : faites bien attention à ne pas oublier de tuples pour calculer la
jointure. En particulier, il faut que les premiers tuples ayant une valeur
différente de celle des tuples mémorisés lors des étapes 1. et 2.
participent bien à la jointure. Pensez bien à les conserver en mémoire.
</p>



<p>
Complétez le code ci-dessous :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">jointure_triee</span><span style="color: #707183;">(</span>table1, col1, table2, col2<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Implémente la jointure de ~table1~ et ~table2~ sous la condition que les</span>
<span style="color: #036A07;">    valeurs de l'attribut ~col1~ de ~table1~ soient égales aux valeurs de</span>
<span style="color: #036A07;">    l'attribut ~col2~ de ~table2~.</span>

<span style="color: #036A07;">    On suppose que ~table1~ est triée suivant les valeurs croissantes de ~col1</span>
<span style="color: #036A07;">    et que ~table2~ est triée suivant les valeurs croissantes de ~col2~.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">yield</span> <span style="color: #707183;">{}</span>
</pre>
</div>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> L'agrégation</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Dans cette partie, nous allons implémenter des fonctions qui permettent de
calculer des agrégats simples et fréquemment utilisés dans des requêtes.
</p>
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> Calcul du minimum</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
Nous allons commencer par le calcul de la valeur minimum associée à un
attribut dans une table.
</p>

<p>
<b>Attention</b> : pour calculer ce minimum, vous devez utiliser une mémoire
constante. Il ne faut pas que vous stockiez toutes les valeurs dans une
liste puis que vous utilisiez une fonction <code class="verbatim">python</code> qui calcule le minimum de
cette liste.
</p>

<p>
Complétez la fonction suivante.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">minimum_table</span><span style="color: #707183;">(</span>table, col<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie la plus petite des valeurs associées à l'attribut ~col~ dans ~table~.</span>
<span style="color: #036A07;">    Si ~table~ est vide, renvoie None.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">return</span> <span style="color: #D0372D;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> Calcul de moyenne</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Nous allons calculer la moyenne des valeurs associées à un attribut d'une
table.
</p>

<p>
<b>Attention</b> : de nouveau, nous allons chercher à avoir une empreinte mémoire
qui est indépendante de la taille de la table considérée. Pour cela, on
pourra stocker les informations suivantes :
</p>
<ul class="org-ul">
<li>la somme des valeurs des attributs des tuples déjà traités,
</li>
<li>le nombre des tuples déjà traités.
</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">moyenne_table</span><span style="color: #707183;">(</span>table, col<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie la moyenne des valeurs que les tuples de ~table~ associent à</span>
<span style="color: #036A07;">    l'attribut ~col~.</span>
<span style="color: #036A07;">    Si ~table~ est vide, renvoie None.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">return</span> <span style="color: #D0372D;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> Calcul d'écart type</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
Nous allons essayer d'appliquer la même méthode pour le calcul de
l'écart-type des valeurs associées à un attribut d'une table.
</p>

<p>
Pour rappel, si v<sub>1</sub>, …, v<sub>n</sub> sont les valeurs dont on souhaite calculer
l'écart-type, celui-ci vaut :
</p>

<p>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span style="font-size: 100%; display: inline-block; position: relative;" class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msqrt&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mfrac&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.968ex" height="7.409ex" style="vertical-align: -3.305ex; margin-left: 4.645ex; margin-right: -4.645ex;" viewBox="0 -1767.3 7736.3 3190.1" role="img" focusable="false" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJSZ4-221A" x="0" y="-91"></use><rect stroke="none" width="6735" height="60" x="1000" y="1600"></rect><g transform="translate(1000,0)"><g transform="translate(120,0)"><rect stroke="none" width="720" height="60" x="0" y="220"></rect><use xlink:href="#MJMAIN-31" x="110" y="676"></use><use xlink:href="#MJMATHI-6E" x="60" y="-686"></use></g><g transform="translate(1127,0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use></g><use xlink:href="#MJMAIN-28" x="2571" y="0"></use><g transform="translate(2961,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2212" x="4013" y="0"></use><use xlink:href="#MJMATHI-6D" x="5013" y="0"></use><g transform="translate(5892,0)"><use xlink:href="#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="550" y="583"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msqrt><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><mi>m</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\sqrt{\frac{1}{n} \sum_{i=1}^n (v_i - m)^2}</script>
</p>

<p>
si m est la moyenne des valeurs.
</p>

<p>
Nous remarquons que:
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span style="font-size: 100%; display: inline-block; position: relative;" class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msubsup&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;msubsup&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="93.225ex" height="7.309ex" style="vertical-align: -3.105ex; margin-left: 4.645ex; margin-right: -4.645ex;" viewBox="0 -1810.3 40138.3 3147" role="img" focusable="false" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use><use xlink:href="#MJMAIN-28" x="1444" y="0"></use><g transform="translate(1834,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2212" x="2886" y="0"></use><use xlink:href="#MJMATHI-6D" x="3886" y="0"></use><g transform="translate(4765,0)"><use xlink:href="#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="550" y="583"></use></g><use xlink:href="#MJMAIN-3D" x="5886" y="0"></use><g transform="translate(6942,0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use></g><use xlink:href="#MJMAIN-28" x="8387" y="0"></use><g transform="translate(8776,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="488"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-430"></use></g><use xlink:href="#MJMAIN-2212" x="9938" y="0"></use><use xlink:href="#MJMAIN-32" x="10939" y="0"></use><g transform="translate(11439,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-213"></use></g><use xlink:href="#MJMATHI-6D" x="12269" y="0"></use><use xlink:href="#MJMAIN-2B" x="13370" y="0"></use><g transform="translate(14370,0)"><use xlink:href="#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="1242" y="583"></use></g><use xlink:href="#MJMAIN-29" x="15703" y="0"></use><use xlink:href="#MJMAIN-3D" x="16370" y="0"></use><g transform="translate(17426,0)"><use xlink:href="#MJSZ4-28"></use><g transform="translate(792,0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use><g transform="translate(1611,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="488"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-430"></use></g></g><use xlink:href="#MJSZ4-29" x="3343" y="0"></use></g><use xlink:href="#MJMAIN-2212" x="21784" y="0"></use><use xlink:href="#MJMAIN-32" x="22785" y="0"></use><use xlink:href="#MJMATHI-6D" x="23285" y="0"></use><g transform="translate(24330,0)"><use xlink:href="#MJSZ4-28"></use><g transform="translate(792,0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use><g transform="translate(1611,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-213"></use></g></g><use xlink:href="#MJSZ4-29" x="3233" y="0"></use></g><use xlink:href="#MJMAIN-2B" x="28579" y="0"></use><use xlink:href="#MJMATHI-6E" x="29579" y="0"></use><g transform="translate(30180,0)"><use xlink:href="#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="1242" y="583"></use></g><use xlink:href="#MJMAIN-3D" x="31790" y="0"></use><g transform="translate(32846,0)"><use xlink:href="#MJSZ4-28"></use><g transform="translate(792,0)"><use xlink:href="#MJSZ2-2211" x="0" y="0"></use><g transform="translate(147,-1090)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="721" y="1627"></use><g transform="translate(1611,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="488"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-430"></use></g></g><use xlink:href="#MJSZ4-29" x="3343" y="0"></use></g><use xlink:href="#MJMAIN-2212" x="37204" y="0"></use><use xlink:href="#MJMATHI-6E" x="38205" y="0"></use><g transform="translate(38805,0)"><use xlink:href="#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="1242" y="583"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><mi>m</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mo stretchy="false">(</mo><msubsup><mi>v</mi><mi>i</mi><mn>2</mn></msubsup><mo>−</mo><mn>2</mn><msub><mi>v</mi><mi>i</mi></msub><mi>m</mi><mo>+</mo><msup><mi>m</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>v</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mo>)</mo></mrow><mo>−</mo><mn>2</mn><mi>m</mi><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>v</mi><mi>i</mi></msub></mrow><mo>)</mo></mrow><mo>+</mo><mi>n</mi><msup><mi>m</mi><mn>2</mn></msup><mo>=</mo><mrow><mo>(</mo><mrow><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>v</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mo>)</mo></mrow><mo>−</mo><mi>n</mi><msup><mi>m</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-2">\sum_{i=1}^n (v_i - m)^2 = \sum_{i=1}^n (v_i^2 - 2v_i m  + m^2) =
    \left(\sum_{i=1}^n v_i^2\right) -2 m\left(\sum_{i=1}^n v_i\right) + nm^2 =  \left(\sum_{i=1}^n v_i^2\right) - nm^2</script>
</p>

<p>
Ainsi en maintenant la somme des carrés des valeurs en plus des informations
utilisées pour le calcul de la moyenne, il est possible de calculer l'écart
type en utilisant une mémoire bornée.
</p>

<p>
Complétez la fonction suivante :
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">def</span> <span style="color: #006699;">ecart_type_table</span><span style="color: #707183;">(</span>table, col<span style="color: #707183;">)</span>:
    <span style="color: #036A07;">"""Renvoie l'écart type des valeurs que les tuples de ~table~ associent à</span>
<span style="color: #036A07;">    l'attribut ~col~.</span>
<span style="color: #036A07;">    Si ~table~ est vide, renvoie None.</span>
<span style="color: #036A07;">    """</span>
    <span style="color: #0000FF;">return</span> <span style="color: #D0372D;">None</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div></div></div>


</body></html>